!function(){"use strict";var e=window.wp.element,t=window.wp.components;window.wp.i18n;const o=(e,t)=>{var o,l;const n=(null==t?void 0:t.id)||(null===(o=e.find((e=>e.title.rendered===t)))||void 0===o?void 0:o.id);if(n)return n;const r=t.toLocaleLowerCase();return null===(l=e.find((e=>e.title.rendered.toLocaleLowerCase()===r)))||void 0===l?void 0:l.id},l=l=>{let{post_label:n,posts:r,value:s,onChange:c}=l;if(null==r||!r.length)return null;const a=s.map((e=>r.find((t=>t.id===e)))).filter(Boolean).map((e=>({id:e.id,value:e.title.rendered})));return(0,e.createElement)("div",{className:"block-library-query-inspector__taxonomy-control"},(0,e.createElement)(t.FormTokenField,{label:n,value:a,suggestions:r.map((e=>e.title.rendered)),onChange:e=>{const t=new Set,l=new Set;for(const n of e){const e=o(r,n);e&&(t.add(e),l.add(n.value?n.value:n))}c(Array.from(t))}}))},{createHigherOrderComponent:n}=wp.compose,{Fragment:r}=wp.element,{InspectorControls:s}=wp.blockEditor,{PanelBody:c,ToggleControl:a,PanelRow:d}=wp.components,{union:u}=lodash,i=n((t=>o=>{const{name:n,attributes:i,setAttributes:p}=o,{query:m}=i,w=wp.data.select("core/editor").getCurrentPostId(),y=wp.data.select("core/editor").getCurrentPostType(),[f,E]=(0,e.useState)([]),x=(0,e.useRef)(m);if("core/query"!==n)return(0,e.createElement)(t,o);const g=(e,t)=>e.filter((e=>!t.includes(e)));return(0,e.useEffect)((()=>{x.postType&&p({query:{...m,exclude:[]}}),(async()=>{await wp.api.loadPromise;const e="post"===m.postType?new wp.api.collections.Posts:new wp.api.collections.Pages;let t=await e.fetch({data:{per_page:100,post_type:m.postType,status:"publish"}});for(;e.hasMore();){const o=await e.more();t=t.concat(o)}E(t)})()}),[m.postType]),(0,e.createElement)(r,null,(0,e.createElement)(t,o),(0,e.createElement)(s,null,(0,e.createElement)(c,{title:"Exclude Posts",initialOpen:!1},y===m.postType?(0,e.createElement)(d,null,(0,e.createElement)(a,{label:"Exclude Current Post",help:m.exclude.includes(w)?"Exclude current post from query results.":"Include current post from query results.",checked:m.exclude.includes(w),onChange:()=>{var e,t;p({query:{...m,exclude:m.exclude.includes(w)?g(m.exclude,[w]):(e=m.exclude,t=[w],u(e,t))}})}})):null,(0,e.createElement)(d,null,(0,e.createElement)(l,{post_label:"Excluded Posts",posts:f,value:m.exclude,onChange:e=>{p({query:{...m,exclude:e}})}})))))}),"withInspectorControl");wp.hooks.addFilter("editor.BlockEdit","query-block-extension/exclude-posts/add-controls",i)}();